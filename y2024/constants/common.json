{% from 'y2024/constants/common.jinja2' import intake_upper, intake_lower %}

"common": {
  "target_map": {% include 'y2024/vision/maps/target_map.json' %},
  "shooter_interpolation_table": [
    {
        "distance_from_goal": 5.0,
        "shot_params": {
            "shot_velocity": 0.0,
            "shot_altitude_angle": 0.0,
            "shot_catapult_angle": 0.0,
            "shot_speed_over_ground": 2.0
        }
    },
    {
      "distance_from_goal": 10.0,
      "shot_params": {
          "shot_velocity": 0.0,
          "shot_altitude_angle": 0.0,
          "shot_catapult_angle": 0.0,
          "shot_speed_over_ground": 4.0
      }
    }
  ],
  "intake_roller_voltages": {
    "spitting": -4.0,
    "intaking": 12.0
  },
  "intake_pivot_set_points": {
    "extended": -0.03,
    "retracted": 1.73
  },
  "intake_pivot": {
    "zeroing_voltage": 3.0,
    "operating_voltage": 12.0,
    "zeroing_profile_params": {
      "max_velocity": 0.5,
      "max_acceleration": 3.0
    },
    "default_profile_params":{
      "max_velocity": 4.0,
      "max_acceleration": 10.0
    },
    "range": {
        "lower_hard": -0.2,
        "upper_hard": 1.80,
        "lower": {{ intake_lower }},
        "upper": {{ intake_upper }}
    },
    "loop": {% include 'y2024/control_loops/superstructure/intake_pivot/integral_intake_pivot_plant.json' %}
  },
  "drivetrain": {% include 'y2024/control_loops/drivetrain/drivetrain_config.json' %},
  // TODO: (niko) update the stator and supply current limits for the intake
  "current_limits": {
    // Values in amps
    "intake_pivot_supply_current_limit": 40,
    "intake_pivot_stator_current_limit": 100,
    "intake_roller_supply_current_limit": 20,
    "intake_roller_stator_current_limit": 50,
    "transfer_roller_supply_current_limit": 20,
    "transfer_roller_stator_current_limit": 50,
    "drivetrain_supply_current_limit": 35,
    "drivetrain_stator_current_limit": 60,
    "climber_supply_current_limit": 30,
    "climber_stator_current_limit": 100,
    "extend_supply_current_limit": 20,
    "extend_stator_current_limit": 100,
    "extend_roller_supply_current_limit": 60,
    "extend_roller_stator_current_limit": 200,
    "turret_supply_current_limit": 20,
    "turret_stator_current_limit": 40,
    "altitude_supply_current_limit": 10,
    "altitude_stator_current_limit": 60,
    "catapult_supply_current_limit": 60,
    "catapult_stator_current_limit": 250,
    "retention_roller_stator_current_limit": 20,
    "slower_retention_roller_stator_current_limit": 2,
    "shooting_retention_roller_stator_current_limit": -20,
    "retention_roller_supply_current_limit": 10
  },
  "transfer_roller_voltages": {
    "transfer_in": 12.0,
    "transfer_out": -4.0,
    "extend_moving": 4.0
  },
  "extend_roller_voltages": {
    "scoring": 12.0,
    "reversing": -4.0
  },
  "climber_set_points": {
    "full_extend": -0.005,
    "stowed": -0.35,
    "retract": -0.478
  },
  "climber": {
    "zeroing_voltage": 3.0,
    "operating_voltage": 12.0,
    "zeroing_profile_params": {
      "max_velocity": 0.5,
      "max_acceleration": 3.0
    },
    "default_profile_params":{
      "max_velocity": 0.05,
      "max_acceleration": 3.0
    },
    "range": {
        "lower_hard": -0.488,
        "upper_hard": 0.005,
        "lower": -0.478,
        "upper": -0.005
    },
    "loop": {% include 'y2024/control_loops/superstructure/climber/integral_climber_plant.json' %}
  },
  "catapult": {
    "zeroing_voltage": 3.0,
    "operating_voltage": 12.0,
    "zeroing_profile_params": {
      "max_velocity": 1.0,
      "max_acceleration": 6.0
    },
    "default_profile_params":{
      "max_velocity": 0.025,
      "max_acceleration": 0.05
    },
    "range": {
        "lower_hard": -0.05,
        "upper_hard": 4.2,
        "lower": 0.0,
        "upper": 2.38
    },
    "loop": {% include 'y2024/control_loops/superstructure/catapult/integral_catapult_plant.json' %}
  },
  // TODO: (max) update the constants for the shooter subsystems
  "altitude": {
    "zeroing_voltage": 3.0,
    "operating_voltage": 12.0,
    "zeroing_profile_params": {
      "max_velocity": 0.5,
      "max_acceleration": 3.0
    },
    "default_profile_params":{
      "max_velocity": 3.0,
      "max_acceleration": 5.0
    },
    "range": {
        "lower_hard": -0.01,
        "upper_hard": 1.66,
        "lower": 0.0135,
        "upper": 1.57
    },
    "loop": {% include 'y2024/control_loops/superstructure/altitude/integral_altitude_plant.json' %}
  },
  "turret": {
    "zeroing_voltage": 3.0,
    "operating_voltage": 12.0,
    "zeroing_profile_params": {
      "max_velocity": 0.5,
      "max_acceleration": 3.0
    },
    "default_profile_params":{
      "max_velocity": 2.0,
      "max_acceleration": 5.0
    },
    "range": {
        "lower_hard": -4.8,
        "upper_hard": 4.8,
        "lower": -4.7,
        "upper": 4.7
    },
    "loop": {% include 'y2024/control_loops/superstructure/turret/integral_turret_plant.json' %}
  },
  "extend": {
    "zeroing_voltage": 3.0,
    "operating_voltage": 12.0,
    "zeroing_profile_params": {
      "max_velocity": 0.5,
      "max_acceleration": 3.0
    },
    "default_profile_params":{
      "max_velocity": 0.1,
      "max_acceleration": 0.3
    },
    "range": {
        "lower_hard": -0.005,
        "upper_hard": 0.47,
        "lower": 0.005,
        "upper": 0.46
    },
    "loop": {% include 'y2024/control_loops/superstructure/extend/integral_extend_plant.json' %}
  },
  "shooter_targets": {
    "red_alliance": {
        "pos": {
            "rows": 3,
            "cols": 1,
            "storage_order": "ColMajor",
            // The data field contains the x, y and z
            // coordinates of the speaker on the red alliance
            "data": [8.0645, 1.4435, 2.0705]
        },
        "theta": 0.0
    },
    "blue_alliance": {
        "pos": {
            "rows": 3,
            "cols": 1,
            "storage_order": "ColMajor",
            // The data field contains the x, y and z
            // coordinates of the speaker on the blue alliance
            "data": [-8.0645, 1.4435, 2.0705]
        },
        "theta": 0.0
    }
  },
  "altitude_loading_position": 0.02,
  "turret_loading_position": 0.58,
  "catapult_return_position": 0.0,
  "min_altitude_shooting_angle": 0.55,
  "max_altitude_shooting_angle": 0.89,
  "retention_roller_voltages": {
    "retaining": 1.5,
    "spitting": 6.0
  },
  // TODO(Filip): Update the speaker and amp shooter setpoints
  "shooter_speaker_set_point": {
    "turret_position": 0.0,
    "altitude_position": 0.75,
    "shot_velocity": 0.0
  },
  "shooter_podium_set_point":{
    "turret_position": 0.0,
    "altitude_position": 0.0,
    "shot_velocity": 0.0
  },
  "extend_set_points": {
    "trap": 0.46,
    "amp": 0.2,
    "catapult": 0.017,
    "retracted": 0.017
  },
  "turret_avoid_extend_collision_position": 0.0
}
